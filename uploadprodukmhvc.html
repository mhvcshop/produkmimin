<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upload Produk Baru</title>
  <style>
    form { max-width: 600px; margin: auto; display: flex; flex-direction: column; gap: 10px; }
    label { font-weight: bold; }
  </style>
</head>
<body>
  <h2>Tambah Produk Baru</h2>
  <form id="productForm">
    <label>Judul Produk:</label>
    <input type="text" id="title" required>

    <label>Deskripsi Produk:</label>
    <textarea id="description" required></textarea>

    <label>Harga Produk:</label>
    <input type="text" id="price" required>

    <label>Nomor WhatsApp (628xxxx):</label>
    <input type="text" id="phone" required>

    <label>Upload Maksimal 7 Gambar:</label>
    <input type="file" id="images" multiple accept="image/*" required>

    <button type="submit">Upload Produk</button>
  </form>

  <script>
    const apiKey = '19e1e308a65669a3fe2750997f38d43a';

    document.getElementById('productForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const files = document.getElementById('images').files;
      if (files.length > 7) {
        alert("Maksimal 7 gambar!");
        return;
      }

      const title = document.getElementById('title').value;
      const description = document.getElementById('description').value;
      const price = document.getElementById('price').value;
      const phone = document.getElementById('phone').value;

      const imageLinks = [];

      for (const file of files) {
        const base64 = await toBase64(file);
        const formData = new FormData();
        formData.append("key", apiKey);
        formData.append("image", base64.split(',')[1]);

        const res = await fetch("https://api.imgbb.com/1/upload", {
          method: "POST",
          body: formData
        });

        const result = await res.json();
        imageLinks.push(result.data.url);
      }

      const newProduct = {
        id: Date.now(),
        title,
        description,
        price,
        status: "Ready âœ”",
        phone,
        thumbnail: imageLinks[0],
        images: imageLinks
      };

      const existingProducts = JSON.parse(localStorage.getItem("products") || "[]");
      existingProducts.push(newProduct);
      localStorage.setItem("products", JSON.stringify(existingProducts));

      alert("Produk berhasil ditambahkan!");
      location.reload();
    });

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
      });
    }
  </script>
</body>
</html>
